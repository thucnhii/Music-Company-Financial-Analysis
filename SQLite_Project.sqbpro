<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="C:/Users/DELL/Downloads/SQL/Ex_Files_SQL_EssT/Ex_Files_SQL_EssT/Exercise Files/WSDA_Music.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="150"/><column_width id="3" width="6158"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><current_table name="4,5:mainAlbum"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="Album" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="100"/><column index="2" value="300"/><column index="3" value="90"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Artist" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="1" mode="0"/></sort><column_widths><column index="1" value="90"/><column index="2" value="226"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Customer" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="131"/><column index="2" value="115"/><column index="3" value="125"/><column index="4" value="300"/><column index="5" value="300"/><column index="6" value="199"/><column index="7" value="65"/><column index="8" value="149"/><column index="9" value="123"/><column index="10" value="199"/><column index="11" value="189"/><column index="12" value="282"/><column index="13" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Employee" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="133"/><column index="2" value="111"/><column index="3" value="115"/><column index="4" value="187"/><column index="5" value="115"/><column index="6" value="195"/><column index="7" value="195"/><column index="8" value="275"/><column index="9" value="102"/><column index="10" value="65"/><column index="11" value="92"/><column index="12" value="123"/><column index="13" value="178"/><column index="14" value="178"/><column index="15" value="256"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Genre" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="96"/><column index="2" value="172"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Invoice" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="111"/><column index="2" value="131"/><column index="3" value="195"/><column index="4" value="300"/><column index="5" value="199"/><column index="6" value="129"/><column index="7" value="156"/><column index="8" value="187"/><column index="9" value="79"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="InvoiceLine" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="153"/><column index="2" value="111"/><column index="3" value="91"/><column index="4" value="105"/><column index="5" value="99"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Track" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="2" mode="0"/></sort><column_widths><column index="1" value="91"/><column index="2" value="222"/><column index="3" value="100"/><column index="4" value="145"/><column index="5" value="96"/><column index="6" value="295"/><column index="7" value="135"/><column index="8" value="117"/><column index="9" value="105"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="V_AvgTotal" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="365"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="V_Tracks_InvoiceLine" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="125"/><column index="2" value="115"/><column index="3" value="111"/><column index="4" value="131"/><column index="5" value="195"/><column index="6" value="79"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="Code">/*
SCENARIO: Manager of WSDA Music Company has been unable to account
for a discrepancy in his company's financials.
The further analyze has helped him to figure out that the discrepancy
occurred between the years 2011 and 2012. But the managers want to know who
is exactly the problem.
*/


--1. The number of transactions took place between 2011 and 2012.
SELECT
	count(*)
FROM
	Invoice
WHERE
	InvoiceDate BETWEEN '2011-01-01' AND '2012-12-31'
	
--2. The amount of money that WSDA made during that period.
	
	SELECT
	sum(total) as [Total Sales between 2011 and 2012]
FROM
	Invoice
WHERE
	InvoiceDate BETWEEN '2011-01-01' AND '2012-12-31'

--3. A list of customers who made purchases between 2011 and 2012 

SELECT
Customer.FirstName,
Customer.LastName,
Invoice.Total
FROM
	Customer 
INNER JOIN Invoice 
ON Customer.CustomerId = Invoice.CustomerId
WHERE
	Invoice.InvoiceDate BETWEEN '2011-01-01' AND '2012-12-31'
	ORDER BY
	Invoice.total DESC
	
--4. A list of customers, sales representatives, and total transaction amounts for each
-- customer between 2011 and 2012.
SELECT 
Customer.FirstName as [Customer First Name],
Customer.LastName as [Customer Last Name],
Employee.FirstName as [Employee First Name],
Employee.LastName as [Employee Last Name],
Invoice.total
FROM Customer
INNER JOIN Employee
ON Customer.SupportRepId = Employee.EmployeeId
INNER JOIN Invoice
ON Customer.CustomerId = Invoice.CustomerId
WHERE 
	InvoiceDate BETWEEN '2011-01-01' AND '2012-12-31'
	ORDER BY
		Invoice.Total DESC
		
--5. The number of transactions that are above the average transaction amount
--during the same time period.

SELECT 
	count(total) as [Number of Transaction Above Avg]
FROM
	Invoice
WHERE 

total &gt;
(SELECT
avg(total) 
FROM
Invoice
WHERE 
	InvoiceDate BETWEEN '2011-01-01' AND '2012-12-31')
AND
	InvoiceDate BETWEEN '2011-01-01' AND '2012-12-31'
	
--6. The average transaction amount for each year that WSDA Music has been in business
	
SELECT
	round(avg(total),2) as [Avg Transaction Amount],
	strftime('%Y', InvoiceDate) AS [Year]
FROM
Invoice
GROUP BY
	strftime('%Y', InvoiceDate)
	
--7. A list of employees who exceeded the average transaction amount from sales
--they generated during 2011 and 2012.

SELECT 
	Employee.FirstName,
	Employee. LastName,
	sum(total) as [Total Sales]

FROM
Employee
INNER JOIN Customer
on Employee.EmployeeId = Customer.SupportRepId
INNER JOIN Invoice
on Customer.CustomerId = Invoice.CustomerId
WHERE 
	InvoiceDate BETWEEN '2011-01-01' AND '2012-12-31'
AND
total &gt;
(SELECT
avg(total)
FROM
Invoice)
GROUP BY
Employee.FirstName,
Employee.LastName

--8. Create a Commission Payout that displays each employee's commission
--based on 15% of the sales transaction amount.

SELECT
Employee.FirstName,
Employee.LastName,
sum(invoice.total) as [Total Sales],
round(sum(invoice.total)*.15,2) as [Commission Payout]
FROM
Employee
INNER JOIN Customer
on Employee.EmployeeId = Customer.SupportRepId
INNER JOIN Invoice
on Customer.CustomerId = Invoice.CustomerId
WHERE 
	InvoiceDate BETWEEN '2011-01-01' AND '2012-12-31'
GROUP BY
Employee.FirstName,
Employee.LastName

--9. Employee made the highest commission
SELECT 
Employee.FirstName,
Employee.LastName
FROM
Employee
INNER JOIN Customer
on Employee.EmployeeId = Customer.SupportRepId
INNER JOIN Invoice
on Customer.CustomerId = Invoice.CustomerId
WHERE total = (SELECT max(total)
FROM
Invoice)

--10. List the customers that Jane Peacock supported.
SELECT 
Customer.FirstName as [Customer First Name],
Customer.LastName as [Customer Last Name],
Employee.FirstName as [Employee First Name],
Employee.LastName as [Employee Last Name],
sum(invoice.total) as [Total Sales],
round(sum(invoice.total)*.15,2) as [Commission Payout]

FROM Customer
INNER JOIN Employee
ON Customer.SupportRepId = Employee.EmployeeId
INNER JOIN Invoice
ON Customer.CustomerId = Invoice.CustomerId

WHERE 
InvoiceDate BETWEEN '2011-01-01' AND '2012-12-31'
AND
Employee.LastName = 'Peacock'

GROUP BY
Customer.FirstName,
Customer.LastName,
Employee.FirstName,
Employee.LastName

--11. The customer made the highest purchase.
SELECT *
FROM
Customer
INNER JOIN Invoice
on customer.CustomerId = Invoice.CustomerId
WHERE total =
(SELECT max(total)
FROM Invoice)

--12. Take a look at this customer record to see if there is anything suspicous

SELECT *
FROM
Customer
WHERE
Customer.LastName = 'Doeein'


/*
CONCLUSION: Jane Peacock is our primary of interest.
*/
</sql><current_tab id="0"/></tab_sql></sqlb_project>
